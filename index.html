<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS & Compass Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 20px; }
        #status { font-weight: bold; color: #0056b3; margin-bottom: 20px;}
        .data { margin-bottom: 5px; font-size: 0.95em; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        
        /* --- Compass Styles --- */
        #compass-container {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            border-radius: 50%;
            border: 5px solid #333;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            background-color: #fff;
        }

        /* Compass Face (Static Background) */
        #compass-face {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 50%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><circle cx="100" cy="100" r="100" fill="%23fff"/><text x="100" y="25" text-anchor="middle" font-size="20" fill="red">N</text><text x="185" y="105" text-anchor="middle" font-size="20">E</text><text x="100" y="190" text-anchor="middle" font-size="20">S</text><text x="15" y="105" text-anchor="middle" font-size="20">W</text></svg>');
            background-repeat: no-repeat;
            background-size: cover;
            /* Simple tick marks and direction labels are usually created using a background image or complex CSS */
        }

        /* Compass Arrow (Needle) - The element that rotates */
        #compass-arrow {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            /* Set the rotation point to the center */
            transform-origin: 50% 50%;
            
            /* The image data for a simple needle */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><polygon points="100,5 90,100 100,195 110,100" fill="red"/><circle cx="100" cy="100" r="10" fill="black"/></svg>');
            background-repeat: no-repeat;
            background-size: cover;
        }
        
        /* Center dot for the arrow */
        #center-dot {
            width: 20px;
            height: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background-color: black;
            z-index: 10;
        }

        .heading-display {
            font-size: 1.2em;
            font-weight: bold;
            color: red;
            margin-top: 10px;
        }

    </style>
</head>
<body>

    <h1>Mobile Location and Direction</h1>
    <p id="status">Click "Start Tracking" to begin...</p>

    <button onclick="startTracking()">Start Tracking</button>
    <button onclick="stopTracking()">Stop Tracking</button>

    <hr>

    <h2>GPS Coordinates</h2>
    <div class="data">
        <strong>Latitude:</strong> <span id="latitude">N/A</span>
    </div>
    <div class="data">
        <strong>Longitude:</strong> <span id="longitude">N/A</span>
    </div>
    <div class="data">
        <strong>Accuracy:</strong> <span id="accuracy">N/A</span>
    </div>

    <hr>

    <h2>Compass Direction</h2>
    <div id="compass-container">
        <div id="compass-face"></div>
        <div id="compass-arrow"></div>
        <div id="center-dot"></div>
    </div>
    <div class="heading-display">
        Heading: <span id="heading">N/A</span> Â°
    </div>

    <script>
        let watchID;
        let orientationHandler = null;

        // --- GPS (Geolocation API) ---
        function getCoordinates() {
            if (!navigator.geolocation) {
                document.getElementById('status').textContent = 'Geolocation is not supported by your browser.';
                return;
            }

            const options = {
                enableHighAccuracy: true,
                maximumAge: 0,
                timeout: 5000
            };

            watchID = navigator.geolocation.watchPosition(
                (position) => {
                    document.getElementById('status').textContent = 'Location tracking active.';
                    document.getElementById('latitude').textContent = position.coords.latitude.toFixed(6);
                    document.getElementById('longitude').textContent = position.coords.longitude.toFixed(6);
                    document.getElementById('accuracy').textContent = `${position.coords.accuracy.toFixed(2)} meters`;
                    // Altitude removed for brevity, can be re-added if needed
                },
                (error) => {
                    document.getElementById('status').textContent = `Geolocation Error (${error.code}): ${error.message}`;
                },
                options
            );
        }

        // --- Direction (DeviceOrientation API) ---
        function getDirection() {
            // Check for iOS 13+ permission request
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            addOrientationListener();
                        } else {
                            document.getElementById('heading').textContent = 'Permission denied.';
                        }
                    })
                    .catch(console.error);
            } else {
                // Handle standard permission model (Android/Older iOS)
                addOrientationListener();
            }
        }

        function addOrientationListener() {
            const arrowElement = document.getElementById('compass-arrow');

            orientationHandler = (event) => {
                let absoluteHeading = null;
                
                // 1. iOS Specific (Most reliable for absolute North)
                if (event.webkitCompassHeading !== undefined) {
                    absoluteHeading = event.webkitCompassHeading;
                } 
                // 2. Standard W3C alpha (Can be absolute on some Android/Chrome, or relative)
                else if (event.alpha !== null) {
                    // For the visual compass, we need the rotation of the device relative to North.
                    // The standard alpha value is often 0-360 where 0 is arbitrary or North (device dependent).
                    // If it is an absolute heading, we often need to calculate 360 - alpha.
                    // This is the most inconsistent part of the web API. We'll try 360 - alpha as a common pattern.
                    if (event.absolute) {
                       // If absolute is true, 360 - alpha is usually the heading.
                       absoluteHeading = 360 - event.alpha; 
                    } else {
                       // Fallback to alpha if absolute property is missing or false (may be relative)
                       absoluteHeading = event.alpha; 
                    }
                }
                
                if (absoluteHeading !== null) {
                    // Ensure the number is between 0 and 360
                    const rotation = absoluteHeading % 360; 
                    
                    // Update the visual display and the arrow's rotation
                    document.getElementById('heading').textContent = rotation.toFixed(1);
                    arrowElement.style.transform = `rotate(${rotation}deg)`;
                } else {
                    document.getElementById('heading').textContent = 'N/A (Sensor Error)';
                }
            };

            window.addEventListener('deviceorientation', orientationHandler, true);
        }

        // --- Control Functions ---
        function startTracking() {
            document.getElementById('status').textContent = 'Requesting permissions...';
            getCoordinates();
            getDirection();
        }

        function stopTracking() {
            if (watchID) {
                navigator.geolocation.clearWatch(watchID);
                watchID = null;
            }
            if (orientationHandler) {
                window.removeEventListener('deviceorientation', orientationHandler, true);
                orientationHandler = null;
            }
            document.getElementById('status').textContent = 'Tracking stopped.';
            document.getElementById('compass-arrow').style.transform = `rotate(0deg)`; // Reset visual
        }
    </script>

</body>
</html>
